##  Ble蓝牙通讯协议

#### 蓝牙服务

* 通信中用到的蓝牙服务如下：

* 服务UUID：0xfff0

* | 特征值 | 可执行操作 | 备注                               |
  | ------ | ---------- | ---------------------------------- |
  | 0xfff1 | Notify     | 接收终端数据(必须保证notify被使能) |
  | 0xfff2 | Write      | 向终端发送数据                     |

* 服务UUID：0X180D

* | 特征值 | 可执行操作 | 备注                               |
  | ------ | ---------- | ---------------------------------- |
  | 0x2A37 | Notify     | 接收心率数据(必须保证notify被使能) |
  | 0x2A38 | Notify     |                                    |

* 服务0XFFF0用于数据通信，协议的大部分数据都是通过该服务进行的。服务0X180D主要用于实时传送心率数据。

#### 通讯协议

* 注：

  1.  协议中所有非单字节类型的数据除特殊说明外均为**小端序**

  2.  接收数据设备需要做数据**拼包**处理，否则可能出现接收不全问题

     

* 协议帧定义

* | 包头  (1B) | 控制码   (1B) | 数据长度  (2B) | 内容数据  (nB) | CRC8  (1B) | 包尾  (1B) |
  | ---------- | ------------- | -------------- | -------------- | ---------- | ---------- |
  | 68H        |               | 内容数据长度   | …              |            | 16H        |


##### 控制码说明







* **注：部分控制码可能与该定义冲突，以实际为准**

* | 7bit                                             | 6bit                           | [5:0]bit |
  | ------------------------------------------------ | ------------------------------ | -------- |
  | 表示方向：  0是手机向手环发送  1是手环向手机发送 | 表示异常位：  0是正常  1是异常 | 帧类型   |

* 如果设备回复的功能码是异常码，则数据域会有异常参数（一个字节），如下：

* | 错误编码 | 编码含义                     |
  | -------- | ---------------------------- |
  | 0x01     | 校验错误                     |
  | 0x02     | 内容错误，内容的值不合理     |
  | 0x03     | 无此项数据（没有此项功能码） |
  | 0X04     | 设备当前不支持该帧的功能     |

  ##### 

##### CRC校验方法

```
例：数据为 68H 01H 02H 00H AAH BBH XXH 16H
XX ==> CRC8 = 68H + 01H + 02H + 00H + AAH + BBH = 01D0H
取低8位为CRC8校验值，即 CRC8 = D0H

```







#### 数据包超时重传策略

* 为保证通信的可靠和稳定性，必须要建立可靠的重传机制。通信的一方在信道空闲时，发送请求命令或者数据，若信道忙，则要等待信道空闲后，再发送请求或者数据，或者要抢占空闲信道间隙。 当通信的一方发送完请求帧后，若一段时间内没收到回应时，须重传该请求帧。一般重传3次即可，重传间隔在500ms ~ 1000ms左右即可。
* 
* 
* 
* 

#### 功能协议

##### 来电提醒（仅android平台） -0x01

* Table 1来电参数如下，参数顺序不能更改，均为纯hex表示的数字：

* | 类型     | 字节长度                       | 说明                                                         |
  | -------- | ------------------------------ | ------------------------------------------------------------ |
  | 类型     | 1                              | 0x00表示开始提醒；  0x01表示结束提醒                         |
  | 电话号码 | 15                             | 电话号码使用ASCII码，字节位不足的话，在后面补0x00; 如果是结束提醒，则不发送这一部分 |
  | 姓名     | 不定长，最大不可以超过32个字节 | 呼叫者的姓名，如果通信录上有该呼叫者，以UTF-8编码发送姓名; 如果通信录没有或结束提醒，则不发送这一部分。 |

* APP请求

* |          | 数据 | 长度 | 说明             |
  | -------- | ---- | ---- | ---------------- |
  | 包头     | 0x68 | 1    |                  |
  | 控制码   | 0x01 | 1    |                  |
  | 数据长度 | 16+n | 2    | 低字节先传       |
  | 数据域   | XX   | 16+n | 具体说明 Table 1 |
  | 校验码   | CS   | 1    |                  |
  | 包尾     | 0x16 | 1    |                  |

* 终端应答

* |          | 数据 | 长度 | 说明       |
  | -------- | ---- | ---- | ---------- |
  | 包头     | 0x68 | 1    |            |
  | 控制码   | 0x81 | 1    |            |
  | 数据长度 | 0    | 2    | 低字节先传 |
  | 校验码   | CS   | 1    |            |
  | 包尾     | 0x16 | 1    |            |

* 例如：电话号码是13656898745，姓名“张三”，则APP只需要向终端发送：

  68  01  1600 00 313336353638393837343500000000 E5BCA0E4B889 33  16

  终端如果成功执行提醒功能，则返回：

  68 81 0000 E9 16

  否则：

  68 c1 0000 29 16

   

  如果用户在手机端操作电话(接听或者挂断)，则需要发送命令以关闭手环提醒：

  68  01 0100 01 6B 16

#####  参数设置和读取 -0x02

* 参数表：

* | 编号 | 内容                          | 大小 | 备注                                                         |
  | ---- | ----------------------------- | ---- | ------------------------------------------------------------ |
  | 0x00 | 12/24小时制                   | 1B   | 0x00:12小时制  0x01:24小时制                                 |
  | 0x01 | 公制/英制                     | 1B   | 0x00:公制  0x01:英制                                         |
  | 0x02 | 心率监控间隔                  | 1B   | 单位分钟：最小值5分钟，最大值60分钟； 若为0X01, 表示连续心率监测(注：目前大部分设备不支持连续心率监测） |
  | 0x03 | 疲劳度监控开关                | 1B   | 0x00：关闭  0x01：开启                                       |
  | 0x04 | 心率自动监控开关              | 1B   | 0x00：关闭  0x01：开启                                       |
  | 0x05 | 日期显示格式                  | 1B   | 0x00: 月：日； 0x01: 日：月                                  |
  | 0x06 | 手环语言版本                  | 1B   | 0x00 : 中文 ; 0x01：英文 ;0x03:繁体中文                      |
  | 0x07 | 血氧连续监测频率              | 1B   | 单位分钟：最小值5分钟，仅支持设置 5，10，15，20，30          |
  | 0x08 | 血氧连续监测开关              | 1B   | 0x00:关闭 0x01:开启                                          |
  | 0x09 | 诊断连续监测频率(未使用,保留) | 1B   | 单位分钟：最小值5分钟，仅支持设置 5，10，15，20，30          |
  | 0x0A | 诊断连续监测开关(未使用,保留) | 1B   | 0x00:关闭 0x01:开启                                          |
  | 0x0B | 血压连续监测频率              | 1B   | 单位分钟：最小值5分钟，仅支持设置 5，10，15，20，30          |
  | 0x0C | 血压连续监测开关              | 1B   | 0x00:关闭 0x01:开启                                          |
  | 0x0D | 服务器配置                    | 48B  | MQTT服务器主机IP（支持域名）  ASCII编码，例如114.116.23.249,发送数据为3131342E3131362E32332E323439...[00补齐] |
  | 0x0E | 端口配置                      | 2B   | MQTT服务器端口                                               |
  | 0x0F | clientID配置                  | 40B  | MQTT客户端ID                                                 |
  | 0x10 | qos配置                       | 1B   | MQTT消息等级设置,0~2                                         |
  | 0x11 | 用户名                        | 48B  | MQTT用户名设置                                               |
  | 0x12 | 密码                          | 48B  | MQTT密码设置                                                 |
  | 0x13 | 订阅主题                      | 48B  | MQTT订阅主题设置                                             |
  | 0x14 | 发布主题                      | 48B  | MQTT发布主题设置                                             |
  | 0x15 | 室内室外状态切换              | 1B   | 室内室外状态切换  0x00: 关闭切换功能  0x01: 开启切换功能  0xff: 未知状态 |
  | 0x16 | 心率预警范围                  | 2B   | [0]:最小心率，[1]:最大心率                                   |
  | 0x17 | 心率预警开关                  | 1B   | 0x00:关闭 0x01:开启                                          |
  | 0x18 | 血氧预警范围                  | 2B   | [0]:最小饱和度，[1]:最大饱和度                               |

* | 0x19 | 血氧预警开关 | 1B   | 0x00:关闭 0x01:开启                                          |
  | ---- | ------------ | ---- | ------------------------------------------------------------ |
  | 0x1A | 血压预警范围 | 4B   | [0]:最小收缩压，[1]:最大收缩压  [2]:最小舒张压，[3]:最大舒张压 |
  | 0x1B | 血压预警开关 | 1B   | 0x00:关闭 0x01:开启                                          |
  | 0x1C | 温度预警范围 | 4B   | [1~0]:最小温度(X100)(LSB)  [3~2]:最大温度(X100)(LSB)         |
  | 0x1D | 温度预警开关 | 1B   | 0x00:关闭 0x01:开启                                          |
  | 0x1E | 气压预警范围 | 4B   | [1~0]:最小气压(hPa)(LSB)  [3~2]:最大气压(hPa)(LSB)           |
  | 0x1F | 气压预警开关 | 1B   | 0x00:关闭 0x01:开启                                          |
  | 0x20 | 跌倒预警模式 | 1B   | 0 一般，1 严格，2 老年                                       |
  | 0x21 | 跌倒预警开关 | 1B   | 0x00:关闭 0x01:开启                                          |

  ###### APP读取参数

  * APP请求

  * |          | 数据 | 长度 | 说明                  |
    | -------- | ---- | ---- | --------------------- |
    | 包头     | 0x68 | 1    |                       |
    | 控制码   | 0x02 | 1    |                       |
    | 数据长度 | 1+n  | 2    | 低字节先传            |
    | 数据域   | XX   | 1+n  | 读取指令：0x00        |
    |          |      |      | 编号0，请参考 Table 2 |
    |          |      |      | 编号1，请参考 Table 2 |
    |          |      |      | …                     |
    | 校验码   | CS   | 1    |                       |
    | 包尾     | 0x16 | 1    |                       |

  * 终端应答

  * |          | 数据 | 长度 | 说明                |
    | -------- | ---- | ---- | ------------------- |
    | 包头     | 0x68 | 1    |                     |
    | 控制码   | 0x82 | 1    |                     |
    | 数据长度 | 1+n  | 2    | 低字节先传          |
    | 数据域   | XX   | 1+n  | 读取指令：0x00      |
    |          |      |      | 编号0 + 内容Table 2 |
    |          |      |      | 编号1 + 内容Table 2 |
    |          |      |      | …                   |
    | 校验码   | CS   | 1    |                     |
    | 包尾     | 0x16 | 1    |                     |

  ###### APP设置参数

  * APP请求

  * |          | 数据 | 长度 | 说明                |
    | -------- | ---- | ---- | ------------------- |
    | 包头     | 0x68 | 1    |                     |
    | 控制码   | 0x02 | 1    |                     |
    | 数据长度 | 1+n  | 2    | 低字节先传          |
    | 数据域   | XX   | 1+n  | 设置指令：0x01      |
    |          |      |      | 编号0 + 内容Table 2 |
    |          |      |      | 编号1 + 内容Table 2 |
    |          |      |      | …                   |
    | 校验码   | CS   | 1    |                     |
    | 包尾     | 0x16 | 1    |                     |

  * 终端应答

  * |          | 数据 | 长度 | 说明                                |
    | -------- | ---- | ---- | ----------------------------------- |
    | 包头     | 0x68 | 1    |                                     |
    | 控制码   | 0x82 | 1    |                                     |
    | 数据长度 | 1+n  | 2    | 低字节先传                          |
    | 数据域   | XX   | 1+n  | 设置指令：0x01                      |
    |          |      |      | 编号0 + 1B 结果(0x00 成功,其他失败) |
    |          |      |      | 编号1 + 1B 结果(0x00 成功,其他失败) |
    |          |      |      | …                                   |
    | 校验码   | CS   | 1    |                                     |
    | 包尾     | 0x16 | 1    |                                     |

  * 注意：

    1.  MQTT设置一次只能设置一项参数。



##### 查看终端设备电量 -0x03

* APP请求

* |          | 数据 | 长度 | 说明       |
  | -------- | ---- | ---- | ---------- |
  | 包头     | 0x68 | 1    |            |
  | 控制码   | 0x03 | 1    |            |
  | 数据长度 | 0    | 2    | 低字节先传 |
  | 校验码   | CS   | 1    |            |
  | 包尾     | 0x16 | 1    |            |

* 终端应答

* |          | 数据 | 长度 | 说明            |
  | -------- | ---- | ---- | --------------- |
  | 包头     | 0x68 | 1    |                 |
  | 控制码   | 0x83 | 1    |                 |
  | 数据长度 | 1    | 2    | 低字节先传      |
  | 数据域   | XX   | 1    | 电池电量：0-100 |
  | 校验码   | CS   | 1    |                 |
  | 包尾     | 0x16 | 1    |                 |

##### 获取终端监测实时数据 -0x06

###### 一般实时数据

* **一般实时数据内容表**

* | 类型         | 长度 | 说明                                        |
  | ------------ | ---- | ------------------------------------------- |
  | 心率         | 1B   | 心率数据(最大值220，超过则用220显示)        |
  | 当前步数     | 4B   | 单位步（低字节先传）                        |
  | 当前里程     | 4B   | 单位米（低字节先传）                        |
  | 当前消耗热量 | 4B   | 单位大卡（KCal）（低字节先传）              |
  | 当前步速     | 1B   | 单位  步/s(保留0)                           |
  | 体表温度     | 2B   | 低字节在前，体表温度原始值                  |
  | 环境温度     | 2B   | 低字节在前，环境温度原始值 计算方法Table  7 |
  | 佩戴状态     | 1B   | 1表示佩戴，0表示未佩戴                      |
  | 血氧         | 1B   | 血氧含量百分比                              |
  | 血压         | 2B   | [1]: 收缩压，[2]: 舒张压                    |
  | 血液粘稠度   | 1B   | 血液粘稠度                                  |
  |              |      |                                             |

* APP请求：

* |          | 数据 | 长度 | 说明               |
  | -------- | ---- | ---- | ------------------ |
  | 包头     | 0x68 | 1    |                    |
  | 控制码   | 0x06 | 1    |                    |
  | 数据长度 | 1    | 2    | 低字节先传         |
  | 数据域   | XX   | 1    | 0x00：一般实时数据 |
  | 校验码   | CS   | 1    |                    |
  | 包尾     | 0x16 | 1    |                    |

* 终端应答

* |          | 数据 | 长度 | 说明               |
  | -------- | ---- | ---- | ------------------ |
  | 包头     | 0x68 | 1    |                    |
  | 控制码   | 0x86 | 1    |                    |
  | 数据长度 | xx   | 2    | 低字节先传         |
  | 数据域   | XX   |      | 0x00：一般实时数据 |
  |          |      |      | 数据内容表 Table 3 |
  | 校验码   | CS   | 1    |                    |
  | 包尾     | 0x16 | 1    |                    |

###### HRV实时数据

* APP请求：

* |          | 数据 | 长度 | 说明              |
  | -------- | ---- | ---- | ----------------- |
  | 包头     | 0x68 | 1    |                   |
  | 控制码   | 0x06 | 1    |                   |
  | 数据长度 | 1    | 2    | 低字节先传        |
  | 数据域   | XX   | 1    | 0x04：HRV实时数据 |
  | 校验码   | CS   | 1    |                   |
  | 包尾     | 0x16 | 1    |                   |

* 终端应答

* |          | 数据 | 长度 | 说明              |
  | -------- | ---- | ---- | ----------------- |
  | 包头     | 0x68 | 1    |                   |
  | 控制码   | 0x86 | 1    |                   |
  | 数据长度 | 1+14 | 2    | 低字节先传        |
  | 数据域   | XX   | 1    | 0x04：HRV实时数据 |
  |          |      | 25   | 5  \|SDNN         |
  |          |      |      | 5 \|TP            |
  |          |      |      | 5 \|LF            |
  |          |      |      | 5\|HF             |
  |          |      |      | 5\|VLF            |
  | 校验码   | CS   | 1    |                   |
  | 包尾     | 0x16 | 1    |                   |

##### 自定义提醒  - 0x09

* **Table 4提醒参数表：**

* | 类型           | 长度               | 说明                                                         |
  | -------------- | ------------------ | ------------------------------------------------------------ |
  | 提醒类型       | 1B                 | 1：运动     2：约会    3：喝水  4：吃药     5：睡觉    6：自定义提醒 |
  | 提醒时间总数   | 1B                 | 表示一天中有几个时间点去提示（最大6个）                      |
  | 提醒时间       | N*2B               | 时分（N是时间点总数）                                        |
  | 星期重复       | 1B                 | 从低位到高位依次代表星期日到星期六，最高位（第7位）默认为0，其他位0表示该星期不重复，1表示该星期重复 |
  | 提醒（语）名称 | 提醒名称的字节长度 | 使用unicode编码，最大44个字节长度，相当于可有22个ascii或中文；如果提醒类型是1~5，则不用传递提醒语 |

###### 读取

* |          | 数据 | 长度 | 说明                                               |
  | -------- | ---- | ---- | -------------------------------------------------- |
  | 包头     | 0x68 | 1    |                                                    |
  | 控制码   | 0x09 | 1    |                                                    |
  | 数据长度 | 2    | 2    | 低字节先传                                         |
  | 数据域   | XX   | 2    | 0x00：读取                                         |
  |          |      |      | 编号：0 – 7  每个提醒都有固定编号，提醒个数最大为8 |
  | 校验码   | CS   | 1    |                                                    |
  | 包尾     | 0x16 | 1    |                                                    |

* 终端应答

* |          | 数据 | 长度 | 说明                                               |
  | -------- | ---- | ---- | -------------------------------------------------- |
  | 包头     | 0x68 | 1    |                                                    |
  | 控制码   | 0x89 | 1    |                                                    |
  | 数据长度 | 2+n  | 2    | 低字节先传                                         |
  | 数据域   | XX   | 2+n  | 0x00：读取                                         |
  |          |      |      | 编号：0 – 7  每个提醒都有固定编号，提醒个数最大为8 |
  |          |      |      | 提醒参数表Table 4                                  |
  | 校验码   | CS   | 1    |                                                    |
  | 包尾     | 0x16 | 1    |                                                    |

###### 设置

* APP请求：

* |          | 数据 | 长度 | 说明                                               |
  | -------- | ---- | ---- | -------------------------------------------------- |
  | 包头     | 0x68 | 1    |                                                    |
  | 控制码   | 0x09 | 1    |                                                    |
  | 数据长度 | 2    | 2    | 低字节先传                                         |
  | 数据域   | XX   | 2+n  | 0x01：设置                                         |
  |          |      |      | 编号：0 – 7  每个提醒都有固定编号，提醒个数最大为8 |
  |          |      |      | 提醒参数表Table 4                                  |
  | 校验码   | CS   | 1    |                                                    |
  | 包尾     | 0x16 | 1    |                                                    |

* 终端应答

* |          | 数据 | 长度 | 说明       |
  | -------- | ---- | ---- | ---------- |
  | 包头     | 0x68 | 1    |            |
  | 控制码   | 0x89 | 1    |            |
  | 数据长度 | 0    | 2    | 低字节先传 |
  | 校验码   | CS   | 1    |            |
  | 包尾     | 0x16 | 1    |            |

###### 删除

* APP请求：

* |          | 数据 | 长度 | 说明                                               |
  | -------- | ---- | ---- | -------------------------------------------------- |
  | 包头     | 0x68 | 1    |                                                    |
  | 控制码   | 0x09 | 1    |                                                    |
  | 数据长度 | 2    | 2    | 低字节先传                                         |
  | 数据域   | XX   | 2    | 0x02：删除                                         |
  |          |      |      | 编号：0 – 7  每个提醒都有固定编号，提醒个数最大为8 |
  | 校验码   | CS   | 1    |                                                    |
  | 包尾     | 0x16 | 1    |                                                    |

* 终端应答

* |          | 数据 | 长度 | 说明       |
  | -------- | ---- | ---- | ---------- |
  | 包头     | 0x68 | 1    |            |
  | 控制码   | 0x89 | 1    |            |
  | 数据长度 | 0    | 2    | 低字节先传 |
  | 校验码   | CS   | 1    |            |
  | 包尾     | 0x16 | 1    |            |

###### 示例

* 设置提醒

  ```
  增加运动提醒，编号为1，提醒个数为1，时间9:31,提醒周期为星期三
  
  APP发送请求：
  68 09 07 00 01 00 01 01 09 20 88 2c 16
  终端应答：
  68 89 00 00 f1 16
  
  ```

* 读取提醒

  ```
  查询编号0的提醒
  
  APP发送请求：
  68 09 02 00 00 00 73 16
  终端应答：
  68 89 07 00 00 00 01 01 09 20 88 ab 16
  
  注意：如果查询的编号没有数据，89变为C9，即异常位置位，后跟数据长度为0
  68 C9 00 00 31 16
  
  ```

* 删除提醒

  ```
  删除编号0的提醒
  
  APP发送请求：
  68 09 02 00 02 00 75 16
  终端应答
  68 89 00 00 f1 16
  
  ```

##### 短消息提醒（仅Android）- 0x0B

* Table 5短消息参数如下，参数顺序不能更改，均为纯hex表示的数字：

* | 类型     | 长度          | 说明                                                         |
  | -------- | ------------- | ------------------------------------------------------------ |
  | 类型     | 1B            | 0x00：短信  0x01：微信  0x02：QQ  0x03：facebook  0x04：skype  0x05：twitter  0x06：whatsAPP  0x10: Line  0x11: Instagram  0x12: HNCloud  0Xf0: 学生手表特定消息  0xfe:  others |
  | 提醒内容 | 100B   (最大) | 短信：发送者姓名，如果发送者不在通信录，则发送发送者的电话号码  微信：根据实际推送显示  QQ：根据实际推送显示  学生手表特定消息：==Table 6==     除学生手表特定消息外，其他消息长度最大100字节，采用UTF-8编码 |

* Table 6学生手表消息内容格式：

* |          | 字节长度 | 说明                           |
  | -------- | -------- | ------------------------------ |
  | 消息属性 | 1        | 01：校内通知；  02：云校通知   |
  | 发送者   | 1        | 发送者名称长度                 |
  |          | N        | 发送者名称，如张老师，数学老师 |
  | 消息编号 | 2        | 每条消息的编号，从1开始。      |
  | 提醒内容 | 2        | 消息内容长度                   |
  |          | N        | 消息内容                       |

* APP请求:

* |          | 数据 | 长度 | 说明               |
  | -------- | ---- | ---- | ------------------ |
  | 包头     | 0x68 | 1    |                    |
  | 控制码   | 0x0B | 1    |                    |
  | 数据长度 | n    | 2    | 低字节先传         |
  | 数据域   | n    | n    | 短消息参数 Table 5 |
  | 校验码   | CS   | 1    |                    |
  | 包尾     | 0x16 | 1    |                    |

* 终端应答:

* |          | 数据 | 长度 | 说明                   |
  | -------- | ---- | ---- | ---------------------- |
  | 包头     | 0x68 | 1    |                        |
  | 控制码   | 0x8B | 1    |                        |
  | 数据长度 | 1    | 2    | 低字节先传             |
  | 数据域   | 1    | 1    | APP请求的类型          |
  |          |      | 1/0  | 消息编号，该字段可选。 |
  | 校验码   | CS   | 1    |                        |
  | 包尾     | 0x16 | 1    |                        |

##### 清除终端数据功能 - 0x11

###### 恢复出厂设置 类型0x01

* APP请求：

* |          | 数据 | 长度 | 说明                        |
  | -------- | ---- | ---- | --------------------------- |
  | 包头     | 0x68 | 1    |                             |
  | 控制码   | 0x11 | 1    |                             |
  | 数据长度 | 1    | 2    | 低字节先传                  |
  | 数据域   | XX   | 1    | 操作类型：0x01-恢复出厂设置 |
  | 校验码   | CS   | 1    |                             |
  | 包尾     | 0x16 | 1    |                             |

* 终端应答：

* |          | 数据 | 长度 | 说明                        |
  | -------- | ---- | ---- | --------------------------- |
  | 包头     | 0x68 | 1    |                             |
  | 控制码   | 0x91 | 1    |                             |
  | 数据长度 | 2    | 2    | 低字节先传                  |
  | 数据域   | XX   | 2    | 操作类型：0x01-恢复出厂设置 |
  |          |      |      | 状态位：0：成功 1：失败     |
  | 校验码   | CS   | 1    |                             |
  | 包尾     | 0x16 | 1    |                             |

##### 找手环功能 - 0x13

* APP请求：

* |          | 数据 | 长度 | 说明                     |
  | -------- | ---- | ---- | ------------------------ |
  | 包头     | 0x68 | 1    |                          |
  | 控制码   | 0x13 | 1    |                          |
  | 数据长度 | 1    | 2    | 低字节先传               |
  | 数据域   | XX   | 1    | 开始：0x00    结束：0x01 |
  | 校验码   | CS   | 1    |                          |
  | 包尾     | 0x16 | 1    |                          |

* 终端应答：

* |          | 数据 | 长度 | 说明                     |
  | -------- | ---- | ---- | ------------------------ |
  | 包头     | 0x68 | 1    |                          |
  | 控制码   | 0x93 | 1    |                          |
  | 数据长度 | 1    | 2    | 低字节先传               |
  | 数据域   | XX   | 1    | 开始：0x00    结束：0x01 |
  | 校验码   | CS   | 1    |                          |
  | 包尾     | 0x16 | 1    |                          |

##### SOS 求救功能 - 0x15

* 终端上传：

* |          | 数据 | 长度 | 说明                                                |
  | -------- | ---- | ---- | --------------------------------------------------- |
  | 包头     | 0x68 | 1    |                                                     |
  | 控制码   | 0x95 | 1    |                                                     |
  | 数据长度 | 1    | 2    | 低字节先传                                          |
  | 数据域   | XX   | 1    | 求救类型：  0x00：按键请求帮助(SOS)  0x01：跌倒求救 |
  |          |      | 8    | 保留(0)                                             |
  | 校验码   | CS   | 1    |                                                     |
  | 包尾     | 0x16 | 1    |                                                     |

* APP应答：

* |          | 数据 | 长度 | 说明          |
  | -------- | ---- | ---- | ------------- |
  | 包头     | 0x68 | 1    |               |
  | 控制码   | 0x15 | 1    |               |
  | 数据长度 | 0    | 1    | 0x01 收到请求 |
  | 校验码   | CS   | 1    |               |
  | 包尾     | 0x16 | 1    |               |

#####  校时功能码：0x20

* APP下发命令：

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x20     | 1        |                                                              |
  | **数据长度** | 4        | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 4        | 时间(本地时间: UTC时间秒数  + 当前时区时间差）  如北京时间(北京处于东八区)  则数值为 UTC时间加8小时(28800秒)所换算出来的秒数 |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

* 终端应答：

* |              | **数据** | **长度** | **说明**   |
  | ------------ | -------- | -------- | ---------- |
  | **包头**     | 0x68     | 1        |            |
  | **控制码**   | 0xa0     | 1        |            |
  | **数据长度** | 0        | 2        | 低字节先传 |
  | **校验码**   | CS       | 1        |            |
  | **包尾**     | 0x16     | 1        |            |

##### 获取全天历史数据 - 0x17

* ==全天历史数据为：当日00:00 至 次日00:00前的数据==

* APP下发：

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6        | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传(要获取的某天)  时间大于2000,若获取 2018 年,则年字节为 2018-2000=18 |
  |              |          | 1        | 包类型值，要获取的历史数据包类型(见具体协议)                 |
  |              |          | 1        | 总包数 (见具体协议)                                          |
  |              |          | 1        | 包序号 (起始包序号1)                                         |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

* 终端应答 

* |              | **数据** | **长度** | **说明**                                         |
  | ------------ | -------- | -------- | ------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                  |
  | **控制码**   | 0x17     | 1        |                                                  |
  | **数据长度** | 6+n      | 2        | 低字节先传                                       |
  | **数据域**   |          | 3        | 时间：年月日，日先传(要获取的某天)               |
  |              |          | 1        | 包类型值，要获取的历史数据包，详情见上传全天数据 |
  |              |          | 1        | 包总数（总包数 0 （错误应答，见下表））          |
  |              |          | 1        | 包序列                                           |
  |              |          | n        | 数据                                             |
  | **校验码**   | CS       | 1        |                                                  |
  | **包尾**     | 0x16     | 1        |                                                  |

* 错误应答

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6        | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传(要获取的某天)                           |
  |              |          | 1        | 包类型值，要获取的历史数据包                                 |
  |              |          | 1        | 总包数 0 （出现错误）                                        |
  |              |          | 1        | 错误码   0：没有当天数据  1: 暂不支持该包类型  2: 包总数错误  3：包序号错误 |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

###### 示例

```
获取 2018-01-01 数据，总包数 2

APP发送(获取第1包)：
68  17  0600  01 01 12 xx 02 01  xx  16
终端应答(第1包数据)：
68  17  xx00  01 01 12 xx 02 01  …  xx  16

APP发送(获取第2包)：
68  17  0600  01 01 12 xx 02 02  xx  16
终端应答(第2包数据)：
68  17  xx00  01 01 12 xx 02 02  …  xx  16

数据获取完成

```

###### 全天总数据 包类型0x00

* 终端应答

* |              | **数据** | **长度** | **说明**             |
  | ------------ | -------- | -------- | -------------------- |
  | **包头**     | 0x68     | 1        |                      |
  | **控制码**   | 0x17     | 1        |                      |
  | **数据长度** | 32       | 2        | 低字节先传           |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传 |
  |              |          | 1        | 包类型值固定为0x00   |
  |              |          | 1        | 包总数  总包数为1    |
  |              |          | 1        | 包序号               |
  |              |          | 4        | 总计步               |
  |              |          | 4        | 总热量，KCal         |
  |              |          | 4        | 总里程，米           |
  |              |          | 4        | 活动时间，分钟       |
  |              |          | 4        | 活动消耗热量，Kcal   |
  |              |          | 4        | 静坐时间，分钟       |
  |              |          | 4        | 静坐消耗热量，Kcal   |
  | **校验码**   | CS       | 1        |                      |
  | **包尾**     | 0x16     | 1        |                      |

* ==注：获取当天的数据为无效数据==

###### 全天运动情况(频率1小时) 包类型0x01

* 终端应答

* | **包头**     | **0x68** | **1** |                                                 |
  | ------------ | -------- | ----- | ----------------------------------------------- |
  | **控制码**   | 0x17     | 1     |                                                 |
  | **数据长度** | 6+n      | 2     | 低字节先传                                      |
  | **数据域**   | XX       | 3     | 时间：年月日，日先传                            |
  |              |          | 1     | 包类型值固定为0x01                              |
  |              |          | 1     | 包总数  总包数为1                               |
  |              |          | 1     | 包序号                                          |
  |              |          | n     | 8  \|4B计步 + 4B卡路里 (代表一个小时的运动数据) |
  |              |          |       | 8 \| 4B计步 + 4B卡路里                          |
  |              |          |       | …\|  …                                          |
  | **校验码**   | CS       | 1     |                                                 |
  | **包尾**     | 0x16     | 1     |                                                 |

###### 全天睡眠情况 包类型0x02

* 一般格式

  * 终端应答

  * |              | **数据** | **长度** | **说明**                                                     |
    | ------------ | -------- | -------- | ------------------------------------------------------------ |
    | **包头**     | 0x68     | 1        |                                                              |
    | **控制码**   | 0x17     | 1        |                                                              |
    | **数据长度** | 42       | 2        | 低字节先传                                                   |
    | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
    |              |          | 1        | 包类型值固定为0x02                                           |
    |              |          | 1        | 包总数  总包数为1                                            |
    |              |          | 1        | 包序号                                                       |
    |              |          | 36       | 睡眠数据，每两个bit表示一个10分钟的睡眠质量,0:活动，1：浅度，2：深度 3：未监测 |
    | **校验码**   | CS       | 1        |                                                              |
    | **包尾**     | 0x16     | 1        |                                                              |

* B10C_v1.8.9及以上的版本格式

  * 终端应答

  * |              | **数据** | **长度** | **说明**                                                     |
    | ------------ | -------- | -------- | ------------------------------------------------------------ |
    | **包头**     | 0x68     | 1        |                                                              |
    | **控制码**   | 0x17     | 1        |                                                              |
    | **数据长度** | 6+n      | 2        | 低字节先传                                                   |
    | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
    |              |          | 1        | 包类型值固定为0x02                                           |
    |              |          | 1        | 包总数  总包数为2                                            |
    |              |          | 1        | 包序号                                                       |
    |              |          | 8        | (仅包序号为 1时包含)  [1-2]: 清醒时间(分钟)  [3-4]: 浅睡时间(分钟)  [5-6]: 深睡时间(分钟)  [7-8]: 快速眼动时间(分钟) |
    |              |          | n        | (若10:00未醒来则会继续监测至清醒)  数据内容: 睡眠状态  + 起始时间(时-分)  睡眠状态:   0 清醒, 1 浅睡, 2  深睡, 3 快速动眼, 255 无效数据  (==**注: 第一组必为浅睡,最后一组必为清醒状态,若出现无效数据则后续数据均为无效数据**==) |
    |              |          |          | 3  \|  1B睡眠状态 + 1B时 +  1B分                             |
    |              |          |          | 3  \|  1B睡眠状态 + 1B时 +  1B分                             |
    |              |          |          | … \|   ...                                                   |
    | **校验码**   | CS       | 1        |                                                              |
    | **包尾**     | 0x16     | 1        |                                                              |

###### 全天计步详情(频率5分钟) 包类型0x04

* 终端应答

* |              | **数据** | **长度** | **说明**                            |
  | ------------ | -------- | -------- | ----------------------------------- |
  | **包头**     | 0x68     | 1        |                                     |
  | **控制码**   | 0x17     | 1        |                                     |
  | **数据长度** | 6+n      | 2        | 低字节先传                          |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                |
  |              |          | 1        | 包类型值固定为0x04                  |
  |              |          | 1        | 总包数 3                            |
  |              |          | 1        | 包序号                              |
  |              |          | n        | 2 \| 2B步数 (代表5分钟内的计步数据) |
  |              |          |          | 2 \|2B步数                          |
  |              |          |          | … \|                                |
  | **校验码**   | CS       | 1        |                                     |
  | **包尾**     | 0x16     | 1        |                                     |

###### 全天热量详情(频率5分钟) 包类型0x05

* 终端应答

* |              | **数据** | **长度** | **说明**                                    |
  | ------------ | -------- | -------- | ------------------------------------------- |
  | **包头**     | 0x68     | 1        |                                             |
  | **控制码**   | 0x17     | 1        |                                             |
  | **数据长度** | 6+n      | 2        | 低字节先传                                  |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                        |
  |              |          | 1        | 包类型值固定为0x05                          |
  |              |          | 1        | 总包数 3                                    |
  |              |          | 1        | 包序号                                      |
  |              |          | n        | 2 \| 2B卡路里 (代表5分钟内的卡路里消耗数据) |
  |              |          |          | 2 \| 2B卡路里                               |
  |              |          |          | …                                           |
  | **校验码**   | CS       | 1        |                                             |
  | **包尾**     | 0x16     | 1        |                                             |

###### 全天心率(频率5秒) 包类型0x07

* 终端应答

* |              | **数据** | **长度** | **说明**                                 |
  | ------------ | -------- | -------- | ---------------------------------------- |
  | **包头**     | 0x68     | 1        |                                          |
  | **控制码**   | 0x17     | 1        |                                          |
  | **数据长度** | 6+n      | 2        | 低字节先传                               |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                     |
  |              |          | 1        | 包类型值固定为0x07                       |
  |              |          | 1        | 总包数  总包数为96                       |
  |              |          | 1        | 包序号                                   |
  |              |          | n        | 1   \| 1B心率值(代表每5秒记录的心率数据) |
  |              |          |          | 1   \|  1B心率值                         |
  |              |          |          | …  \|  …                                 |
  | **校验码**   | CS       | 1        |                                          |
  | **包尾**     | 0x16     | 1        |                                          |

###### 全天血氧(频率5分钟) 包类型0x09

* 终端应答

* |              | **数据** | **长度** | **说明**                                   |
  | ------------ | -------- | -------- | ------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                            |
  | **控制码**   | 0x17     | 1        |                                            |
  | **数据长度** | 6+n      | 2        | 低字节先传                                 |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                       |
  |              |          | 1        | 包类型值固定为0x09                         |
  |              |          | 1        | 包总数  默认总包数为2                      |
  |              |          | 1        | 包序号 （起始 1）                          |
  |              |          | n        | 1   \| 1B血氧值(代表每5分钟监测的血氧数据) |
  |              |          |          | 1   \| 1B血氧值                            |
  |              |          |          | …  \| …                                    |
  | **校验码**   | CS       | 1        |                                            |
  | **包尾**     | 0x16     | 1        |                                            |

###### 全天RRI(频率5秒) 包类型0x0A

* 终端应答

* |              | **数据** | **长度** | **说明**                                |
  | ------------ | -------- | -------- | --------------------------------------- |
  | **包头**     | 0x68     | 1        |                                         |
  | **控制码**   | 0x17     | 1        |                                         |
  | **数据长度** | 6+n      | 2        | 低字节先传                              |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                    |
  |              |          | 1        | 包类型值固定为0x0A                      |
  |              |          | 1        | 包总数 默认总包数为180                  |
  |              |          | 1        | 包序号                                  |
  |              |          | n        | 2  \|  2B RRI值(代表每5秒记录的RRI数据) |
  |              |          |          | 2  \| 2B RRI值                          |
  |              |          |          | … \|                                    |
  | **校验码**   | CS       | 1        |                                         |
  | **包尾**     | 0x16     | 1        |                                         |

###### 全天温度(频率5分钟) 包类型0x0B

* 终端应答

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6+n      | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
  |              |          | 1        | 包类型值固定为0x0B                                           |
  |              |          | 1        | 包总数  默认总包数为6                                        |
  |              |          | 1        | 包序号                                                       |
  |              |          | n        | 体温计算方法Table 7                                          |
  |              |          |          | 4  \| 2B体表温度(0xFFFF无效值) + 2B环境温度  (代表每5分钟记录的温度数据) |
  |              |          |          | 4  \|  2B体表温度(0xFFFF无效值) + 2B环境温度                 |
  |              |          |          | … \|  …                                                      |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

* Table 7**华氏温度计算方法****(****在体表数据不为****0xFFFF****时使用****)****：**

  ```
  {
  	例：一段完整数据[AA BB CC DD](以实际获取为准)
  
  z人体温度,y体表温度,x环境温度(均为浮点型数值)
  y = 0xBBAA * 0.005;
  x = 0xDDCC * 0.005;
  z=0.0337*y*y-0.545*y+1.7088*x-0.0519*x*y+17.626
  }
  
  ```

###### 全天气压值 (频率10分钟) 包类型0x0C

* 终端应答

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6+n      | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
  |              |          | 1        | 包类型值固定为0x0C                                           |
  |              |          | 1        | 包总数  默认总包数为3                                        |
  |              |          | 1        | 包序号                                                       |
  |              |          | n        | 4B气压数据说明: 3B整数 + 1B小数  实际气压值(浮点型) =  (int)[1,3] + (int)[4]/100.0 |
  |              |          |          | 4 \| 4B气压值数据 (代表每10分钟记录的气压数据)               |
  |              |          |          | 4 \| 4B气压值数据                                            |
  |              |          |          | …\|                                                          |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

###### 全天诊断数据(频率10分钟) 包类型0x0D (暂未使用)

* 终端应答

* |              | **数据** | **长度** | **说明**             |
  | ------------ | -------- | -------- | -------------------- |
  | **包头**     | 0x68     | 1        |                      |
  | **控制码**   | 0x17     | 1        |                      |
  | **数据长度** | 6+n      | 2        | 低字节先传           |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传 |
  |              |          | 1        | 包类型值固定为0x0D   |
  |              |          | 1        | 包总数               |
  |              |          | 1        | 包序号               |
  |              |          | n        |                      |
  | **校验码**   | CS       | 1        |                      |
  | **包尾**     | 0x16     | 1        |                      |

###### 全天血压数据(频率5分钟) 包类型0x0E

* 终端应答

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6+n      | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
  |              |          | 1        | 包类型值固定为0x0E                                           |
  |              |          | 1        | 包总数 默认总包数为6                                         |
  |              |          | 1        | 包序号                                                       |
  |              |          | n        | 诊断值:0 正常      1  高压过高， 2 高压过低      3  低压过高， 4 低压过低      5  无效数据 |
  |              |          |          | 3  \|  1B收缩压 + 1B舒张压 + 1B诊断值  (代表每5分钟监测的血压数据) |
  |              |          |          | 3  \|  1B收缩压 + 1B舒张压 + 1B诊断值                        |
  |              |          |          | … \| …                                                       |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

###### 全天佩戴状态(频率5秒) 包类型0x0F

* 终端应答

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6+n      | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
  |              |          | 1        | 包类型值固定为0x0F                                           |
  |              |          | 1        | 包总数 总包数为12                                            |
  |              |          | 1        | 包序号                                                       |
  |              |          | n        | 1B包含40s的佩戴状态,  1bit表示5s的状态，  0表示佩戴 1表示未佩戴 |
  |              |          |          | 1  \| 1B佩戴状态 (代表40秒内的佩戴状态数据)                  |
  |              |          |          | 1  \| 1B佩戴状态                                             |
  |              |          |          | … \|  …                                                      |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

###### 全天HRV(频率5分钟) 包类型0x10

* 终端应答

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6+n      | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
  |              |          | 1        | 包类型值固定为0x10                                           |
  |              |          | 1        | 包总数 总包数为36                                            |
  |              |          | 1        | 包序号                                                       |
  |              |          | n        | 每5B数据说明: 4B整数  + 1B小数                               |
  |              |          |          | 25 \|  5B SDNN + 5B TP + 5B LF + 5B  HF + 5B VLF   (代表每5分钟监测的HRV数据) |
  |              |          |          | 25 \|  5B SDNN + 5B TP + 5B LF + 5B  HF + 5B VLF             |
  |              |          |          | …  \| …                                                      |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

* HRV数据说明:

  ```
  5B SDNN {float sdnn = (int)[1,4] + ((int)[5])/255.0;}
  5B TP   {float tp   = (int)[1,4] + ((int)[5])/255.0;}
  5B LF   {float lf   = (int)[1,4] + ((int)[5])/255.0;}
  5B HF   {float hf   = (int)[1,4] + ((int)[5])/255.0;}
  5B VLF  {float vlf  = (int)[1,4] + ((int)[5])/255.0;}
  ```

* **心理标准：一天平均值/测评情境下的指标**

* | 指标名称 | 计算公式    | 差   | 中       | 好   |
  | -------- | ----------- | ---- | -------- | ---- |
  | 精神压力 | 50+LF/100   | ＞68 | [58, 68] | ＜58 |
  | 疲劳度   | TP/100      | ＜25 | [25, 50] | ＞50 |
  | 抗压能力 | 50+SDNN/10  | ＜60 | [60, 70] | ＞70 |
  | 调节能力 | 40+LF*10/HF | ＜55 | [55, 60] | ＞60 |

###### 全天定位数据(频率5分钟) 包类型0x11

* 终端应答

* |              | **数据** | **长度** | **说明**                                             |
  | ------------ | -------- | -------- | ---------------------------------------------------- |
  | **包头**     | 0x68     | 1        |                                                      |
  | **控制码**   | 0x17     | 1        |                                                      |
  | **数据长度** | 6+n      | 2        | 低字节先传                                           |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                                 |
  |              |          | 1        | 包类型值固定为0x11                                   |
  |              |          | 1        | 包总数 总包数为18                                    |
  |              |          | 1        | 包序号                                               |
  |              |          | n        | 11 \| 1B类型 + 2B可信度 +  4B纬度 + 4B经度 (Table 8) |
  |              |          |          | 11 \| 1B类型 + 2B可信度 +  4B纬度 + 4B经度           |
  |              |          |          | …   \|                                               |
  | **校验码**   | CS       | 1        |                                                      |
  | **包尾**     | 0x16     | 1        |                                                      |

* Table 8 定位数据说明

* | **类型**    |                        | 0-无效类型，1-NB基站定位，2-CAT1基站定位，3-WIFI定位，4-GPS定位 |
  | ----------- | ---------------------- | ------------------------------------------------------------ |
  | **可信度**  | WIFI、**基站**定位类型 | 表示定位误差范围，单位米                                     |
  | GPS定位类型 |                        | 100 表示定位成功4颗卫星SNR 40以上  70  表示定位成功3颗卫星SNR40  50  表示定位成功 2颗卫星SNR40  25  表示定位成功 1颗卫星SNR40  10 表示定位成功 无卫星SNR40 |
  | **纬度**    |                        | 实际纬度值(浮点型) = (int)[1,4]/100000.0                     |
  | **经度**    |                        | 实际纬度值(浮点型) = (int)[1,4]/100000.0                     |

###### 全天历史数据概况 包类型0xFF

* 终端应答

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x17     | 1        |                                                              |
  | **数据长度** | 6+n      | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 3        | 时间：年月日，日先传                                         |
  |              |          | 1        | 包类型值固定为0xFF                                           |
  |              |          | 1        | 包总数 总包数为1                                             |
  |              |          | 1        | 包序号                                                       |
  |              |          | n        | [0]bit代表包序号1状态，  [1]bit代表包序号2状态，  …  以此类推 |
  |              |          |          | 1 \|  计步详情 - 共1包                                       |
  |              |          |          | 1 \|  热量详情 - 共1包                                       |
  |              |          |          | 12 \|  心率包状态 - 共96包                                   |
  |              |          |          | 1 \|  血氧包状态 - 共2包                                     |
  |              |          |          | 23 \|  RRI包状态 - 共180包                                   |
  |              |          |          | 1 \|  温度包状态 - 共6包                                     |
  |              |          |          | 1 \|  气压包状态 - 共3包                                     |
  |              |          |          | 1 \|  血压包状态 - 共6包                                     |
  |              |          |          | 4 \|  HRV包状态 - 共36包                                     |
  |              |          |          | 1 \|  存储日期个数m，m最大7                                  |
  |              |          |          | m*3 \| 1B年 + 1B月 + 1B日 (终端记录历史数据日期)             |
  |              |          |          | …                                                            |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | **0x16** | **1**    |                                                              |

* 历史数据包状态算法：

  ```
  例：获取心率数据包状态
  uint8_t buf[12];//心率数据状态缓存(从0xFF类型返回的数据中获取心率字段数据)
  index 			//要获取的包索引 >= 1
  state = buf[(index-1)/8] & 0x01<<((index-1)%8);
  state 状态值 
  0: 无效数据或未存储数据
  1：有效数据包(该包包含有效数据)
  
  ```

##### 获取终端记录数据 - 0x18

* APP下发命令：

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x18     | 1        |                                                              |
  | **数据长度** | xx       | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 1        | Type                                                         |
  |              |          | 1        | 索引参数(下发 0开始获取记录，  记录上传顺序为 最新记录 -> 旧记录) |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

* 终端应答：

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0x98     | 1        |                                                              |
  | **数据长度** | xx       | 2        | 低字节先传                                                   |
  | **数据域**   | xx       | 1        | Type (若为0表示出现异常,参照下表)                            |
  |              |          | 1        | 索引参数(若为 0 则表示无后续数据,否则应继续下发该索引参数以获取所有数据) |
  |              |          | …        | 数据(无记录时为NULL)                                         |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

* ==错误应答：==

* |              | **数据** | **长度** | **说明**                                  |
  | ------------ | -------- | -------- | ----------------------------------------- |
  | **包头**     | 0x68     | 1        |                                           |
  | **控制码**   | 0x98     | 1        |                                           |
  | **数据长度** | xx       | 2        | 低字节先传                                |
  | **数据域**   | xx       | 1        | Type: 0x00                                |
  |              |          | 1        | 错误码:  0x01 不支持该类型  0x02 数据异常 |
  | **校验码**   | CS       | 1        |                                           |
  | **包尾**     | 0x16     | 1        |                                           |

###### 运动记录 类型0x01

* APP下发命令

* |              | **数据** | **长度** | **说明**   |
  | ------------ | -------- | -------- | ---------- |
  | **包头**     | 0x68     | 1        |            |
  | **控制码**   | 0x18     | 1        |            |
  | **数据长度** | xx       | 2        | 低字节先传 |
  | **数据域**   | XX       | 1        | Type: 0x01 |
  |              |          | 1        | 索引参数   |
  | **校验码**   | CS       | 1        |            |
  | **包尾**     | 0x16     | 1        |            |

* 终端应答：

* |              | **数据** | **长度** | **说明**                                  |
  | ------------ | -------- | -------- | ----------------------------------------- |
  | **包头**     | 0x68     | 1        |                                           |
  | **控制码**   | 0x98     | 1        |                                           |
  | **数据长度** | 2+n      | 2        | 低字节先传                                |
  | **数据域**   | xx       | 1        | Type: 0x01                                |
  |              |          | 1        | 索引参数                                  |
  |              |          | n        | 39  \| 1B运动类型 + 38B运动数据 (Table 9) |
  |              |          |          | 39  \|1B运动类型 + 38B运动数据            |
  |              |          |          | …                                         |
  | **校验码**   | CS       | 1        |                                           |
  | **包尾**     | 0x16     | 1        |                                           |

* Table 9 运动记录数据说明

* | **运动类型** | 0X01徒步, 0X02跑步, 0X03爬山, 0X04球类运动, 0X05力量训练  0X06有氧运动, 0x07跑步机, 0x08跳绳,  0x09室内自行车,  0x0a山地自行车, 0x0b高强度训练,0x0c自由训练, 0x0d游泳, 0x0e瑜伽  0XFE自定义运动 |
  | ------------ | ------------------------------------------------------------ |
  | **运动数据** | [1,4] : 运动时间(本地时间)  [5,8] : 运动时长(秒)  [9,12] : 步数  [13,16]: 距离(米)  [17,18]: 热量消耗(Kcal)  [19]  : 最大心率  [20]  : 平均心率  [21,22]: 平均配速(s/km)  [23,38]: 保留(FF)  ==注:   若某字段数据字节均为0xFF则表明该运动类型无此项参数== |

##### 运动事件上报 - 0x22

* 终端上传

* |              | **数据** | **长度** | **说明**                                                     |
  | ------------ | -------- | -------- | ------------------------------------------------------------ |
  | **包头**     | 0x68     | 1        |                                                              |
  | **控制码**   | 0xa2     | 1        |                                                              |
  | **数据长度** | n        | 2        | 低字节先传                                                   |
  | **数据域**   | XX       | 4        | 开始时间,本地时间的秒数，低字节先传                          |
  |              |          | 4        | 结束时间,本地时间的秒数，低字节先传                          |
  |              |          | 1        | 包类型值固定为4，表示包头                                    |
  |              |          | 1        | 运动类型  0X01: 徒步  0X02：跑步  0X03: 爬山  0X04：球类运动  0X05：力量训练  0X06：有氧运动  >>>>>>>>>>>>>>  **<u>B10新增类型</u>**  0x07: 跑步机  0x08: 跳绳  0x09: 室内自行车  0x0a: 山地自行车  0x0b: 高强度训练  0x0c: 自由训练  0x0d: 游泳  0x0e: 瑜伽  <<<<<<<<<<<<<<   0XFE: 自定义运动 |
  |              |          | 4        | 消耗热量,单位KCal，低字节先传                                |
  |              |          | 4        | 总步数，单位步，低字节先传                                   |
  | **校验码**   | CS       | 1        |                                                              |
  | **包尾**     | 0x16     | 1        |                                                              |

* APP下发

* |              | **数据** | **长度** | **说明**                            |
  | ------------ | -------- | -------- | ----------------------------------- |
  | **包头**     | 0x68     | 1        |                                     |
  | **控制码**   | 0x22     | 1        |                                     |
  | **数据长度** | 4        | 2        | 低字节先传                          |
  | **数据域**   | XX       | 4        | 开始时间,本地时间的秒数，低字节先传 |
  |              |          | 4        | 结束时间,本地时间的秒数，低字节先传 |
  |              |          | 1        | 包类型值固定为4，表示包头           |
  | **校验码**   | CS       | 1        |                                     |
  | **包尾**     | 0x16     | 1        |                                     |

##### 设置终端信息 – 0x35

###### 设置用户信息

* APP下发

* |              | **数据** | **长度** | **说明**                                        |
  | ------------ | -------- | -------- | ----------------------------------------------- |
  | **包头**     | 0x68     | 1        |                                                 |
  | **控制码**   | 0x35     | 1        |                                                 |
  | **数据长度** | n        | 2        |                                                 |
  | **数据域**   |          | 1        | FLAG1: 0X04                                     |
  |              |          | 1        | FLAG2: 0X01(用户信息)                           |
  |              |          | 1+m      | 1B姓名长度 + 姓名数据(UTF-8编码)                |
  |              |          | 1+o      | 1B(编号/学号)长度  + (编号/学号)数据(UTF-8编码) |
  |              |          | 1+p      | 1B(类别/班级)长度  + (类别/班级)数据(UTF-8编码) |
  | **校验码**   | CS       | 1        |                                                 |
  | **包尾**     | 0x16     | 1        |                                                 |
  |              |          |          |                                                 |

* 终端应答：

* |              | **数据** | **长度** | **说明**             |
  | ------------ | -------- | -------- | -------------------- |
  | **包头**     | 0x68     | 1        |                      |
  | **控制码**   | 0xB5     | 1        |                      |
  | **数据长度** | n        | 2        |                      |
  | **数据域**   |          | 1        | FLAG1: 0X04          |
  |              |          | 1        | FLAG2: 0X01          |
  |              |          | 1        | 0x00 OK, other error |
  | **校验码**   | CS       | 1        |                      |
  | **包尾**     | 0x16     | 1        |                      |
  |              |          |          |                      |

##### 终端上传诊断数据 - 0x3a

* 终端上传

* |              | **数据** | **长度** | **说明**           |
  | ------------ | -------- | -------- | ------------------ |
  | **包头**     | 0x68     | 1        |                    |
  | **控制码**   | 0x3a     | 1        |                    |
  | **数据长度** | N        | 2        |                    |
  | **数据域**   | N        | 1        | 类型               |
  |              |          | n        | 诊断数据(Table 10) |
  | **校验码**   | CS       |          |                    |
  | **包尾**     | 0x16     |          |                    |

* Table 10诊断数据说明

* | **类型**        | **长度** | **内容**                                                     |
  | --------------- | -------- | ------------------------------------------------------------ |
  | 0x01 心率       | 1        | 心率值                                                       |
  | 0x02 血压       | 2        | 1B收缩压+ 1B舒张压                                           |
  | 0x03 血氧       | 1        | 血氧饱和度(0~100)                                            |
  | 0x04 HRV        | 25       | 5B SDNN + 5B TP + 5B LF + 5B HF + 5B VLF（[计算方法](#_全天HRV(频率5分钟)_包类型0x10)） |
  | 0x05 血液粘稠度 | 1        | 血液粘稠度                                                   |

##### 原始数据功能 - 0x3c

* <u>**详情见《吾控健康原始数据协议文档》**</u>

##### 标签终端配置 - 0x3d

###### 声光报警器 类型0x01

* 添加报警设备 功能0x01

  * APP下发

  * |              | **数据** | **长度** | **说明**                |
    | ------------ | -------- | -------- | ----------------------- |
    | **包头**     | 0x68     | 1        |                         |
    | **控制码**   | 0x3d     | 1        |                         |
    | **数据长度** | n        | 2        |                         |
    | **数据域**   |          | 1        | 0x01(类型)              |
    |              |          | 1        | 0x01(功能)              |
    |              |          | 2        | 1B设备类型 + 1B设备标识 |
    |              |          | 6        | 6B设备MAC               |
    | **校验码**   | CS       | 1        |                         |
    | **包尾**     | 0x16     | 1        |                         |
    |              |          |          |                         |

  * 终端应答：

  * |              | **数据** | **长度** | **说明**             |
    | ------------ | -------- | -------- | -------------------- |
    | **包头**     | 0x68     | 1        |                      |
    | **控制码**   | 0xBd     | 1        |                      |
    | **数据长度** | n        | 2        |                      |
    | **数据域**   |          | 1        | 0x01(类型)           |
    |              |          | 1        | 0x01(功能)           |
    |              |          | 1        | 0x00 OK, other error |
    | **校验码**   | CS       | 1        |                      |
    | **包尾**     | 0x16     | 1        |                      |
    |              |          |          |                      |

* 删除报警设备 功能0x02

  * APP下发

  * |              | **数据** | **长度** | **说明**                                    |
    | ------------ | -------- | -------- | ------------------------------------------- |
    | **包头**     | 0x68     | 1        |                                             |
    | **控制码**   | 0x35     | 1        |                                             |
    | **数据长度** | n        | 2        |                                             |
    | **数据域**   |          | 1        | 0x01(类型)                                  |
    |              |          | 1        | 0x02(功能) 若无后续数据则为清除所有设备操作 |
    |              |          | 2        | 1B设备类型 + 1B设备标识                     |
    |              |          | 6        | 6B设备MAC                                   |
    | **校验码**   | CS       | 1        |                                             |
    | **包尾**     | 0x16     | 1        |                                             |
    |              |          |          |                                             |

  * 终端应答：

  * |              | **数据** | **长度** | **说明**             |
    | ------------ | -------- | -------- | -------------------- |
    | **包头**     | 0x68     | 1        |                      |
    | **控制码**   | 0xB5     | 1        |                      |
    | **数据长度** | n        | 2        |                      |
    | **数据域**   |          | 1        | 0x01(类型)           |
    |              |          | 1        | 0x02(功能)           |
    |              |          | 1        | 0x00 OK, other error |
    | **校验码**   | CS       | 1        |                      |
    | **包尾**     | 0x16     | 1        |                      |
    |              |          |          |                      |



* 查询报警设备 功能0x03

  * APP下发

  * |              | **数据** | **长度** | **说明**                |
    | ------------ | -------- | -------- | ----------------------- |
    | **包头**     | 0x68     | 1        |                         |
    | **控制码**   | 0x35     | 1        |                         |
    | **数据长度** | n        | 2        |                         |
    | **数据域**   |          | 1        | 0x01(类型)              |
    |              |          | 1        | 0x03(功能)              |
    |              |          | 2        | 1B设备类型 + 1B设备标识 |
    |              |          | 6        | 6B设备MAC               |
    | **校验码**   | CS       | 1        |                         |
    | **包尾**     | 0x16     | 1        |                         |
    |              |          |          |                         |

  * 终端应答：

  * |              | **数据** | **长度** | **说明**             |
    | ------------ | -------- | -------- | -------------------- |
    | **包头**     | 0x68     | 1        |                      |
    | **控制码**   | 0xB5     | 1        |                      |
    | **数据长度** | n        | 2        |                      |
    | **数据域**   |          | 1        | 0x01(类型)           |
    |              |          | 1        | 0x03(功能)           |
    |              |          | 1        | 0x00 OK, other error |
    | **校验码**   | CS       | 1        |                      |
    | **包尾**     | 0x16     | 1        |                      |
    |              |          |          |                      |

    









































































































































































































 

 





